<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
</head>
<body>
        <input type="file" id="1">
<script type="module">
import { encode, decode } from './node_modules/@shelacek/ubjson/dist/ubjson.es.js';
import {
    createConnection,
    CONNECT,
    DISCONNECT,
    ERROR,
    DEFAULT_CHANNEL
} from "../source/socketiyo-client.js";
import { reconnectDelay, randomReconnectDelay, autoReconnect } from "../source/defaultOptions.js";


const socketiyoConnection = createConnection({
    url: `ws://localhost:8080/`,
    reconnectDelay,
    randomReconnectDelay,
    autoReconnect,
    packData: (x) => {
        return encode(x, { optimizeArrays: `onlyTypedArrays` });
    },
    unpackData: (x) => {
        return decode(x, { useTypedArrays: true });
    },
});

document.getElementById("1").addEventListener("input", (event) => {
  console.log(event.target.files[0])

  const reader = new FileReader();
  reader.onload = (aaa) => {
    var fileAsUint8Array = new Uint8Array(aaa.target.result);
    const data = {file:fileAsUint8Array}
    socketiyoConnection.send(data, `file/upload`);
    console.log(data);
    console.log(encode(data, { optimizeArrays: `onlyTypedArrays` }));
    console.log(decode(encode(data, { optimizeArrays: `onlyTypedArrays` }), { useTypedArrays: true }));

  };
  reader.readAsArrayBuffer(event.target.files[0]);
})
</script>
</body>
</html>